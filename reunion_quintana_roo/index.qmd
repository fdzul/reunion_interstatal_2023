---
format: 
  revealjs:
    #theme: ["theme/q-theme.scss"]
    slide-number: c/t
    logo: "https://salud.yucatan.gob.mx/files/get/2889?v=1669754780"
    footer: "[github.com/fdzul](https://joyful-palmier-ec5e33.netlify.app/talks/reunion_interstatal/#/)"
    center-title-slide: true
highlight-style: a11y
---

<h2>Plan Estatal de Prevención y Control del Dengue<br>en Yucatán</h2>

<h2>

</h2>

<hr>

<h3>Felipe Dzul Manzanilla</h3>

<h3>Jorge Palacios</h3>

<h3>Fabián Correa-Morales</h3>

<h3>

</h3>

<h4>Date: 2023-04-05 </h4>
<h4>Update: 2023-07-10 </h4>

<br>

<h4>

`r fontawesome::fa("github", "black")` [github.com/fdzul](https://fdzul.github.io/web_site_fadm/)

![](chains_merida.jpg){.absolute top="155" left="550" width="750"}

```{r setup}
path_arbo <- "/Users/fdzul/Library/CloudStorage/OneDrive-Personal/datasets/DGE/arbo/"
# 3.1 arbovirosis dataset
x <- boldenr::read_dataset_bol(path = path_arbo,
                                dataset = "sinave")
#source("~/Dropbox/r_developments/r_new_functions/3.Functions/static_bump_map.R")
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/static_bump_map.R")
library(sf)
```

## [Manejo Integrado de Aedes]{style="color:#003300"}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

![](https://journals.plos.org/plosntds/article/figure/image?size=large&id=10.1371/journal.pntd.0006845.g001){.absolute top="100" width="800" height="550" right="120"}

## [Operacionalización del MIA]{style="color:#003300"}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Step 1. load the dataset #####
load("/Users/fdzul/Library/CloudStorage/OneDrive-Personal/automatic_read_sinave/8.RData/epid_channel_data.RData")

# Step 2. extract the dengue cases of veracruz ####
x <- x |>
    dplyr::filter(DES_EDO_RES == "VERACRUZ") 

y <- tibble::tibble(SEM = x$SEM,
                    y = x$q25,
                    arm = "Nuevo Paradigma")
prob <- tibble::tibble(SEM = x$SEM,
                       prob = rep(0, length(x$SEM)))

# plot risk stratificaction  #####
ggplot2::ggplot() +
    ggplot2::geom_rect(ggplot2::aes(xmin = c(-Inf, 25), 
                                    xmax = c(25, Inf), 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = c("#2EB67D", "#E01E5A"),
                       alpha = .2) +
    ggplot2::geom_rect(ggplot2::aes(xmin = 20, 
                                    xmax = 25, 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = "#ECB22E",
                       alpha = 0.8) +
    ggplot2::geom_rect(ggplot2::aes(xmin = 38, 
                                    xmax = 40, 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = "#36C5F0",
                       alpha = 0.8) +
    ggplot2::geom_vline(xintercept = 25,
                        color = "gray", #"#36C5F0",
                        size = 1,
                        linetype = 3) +
    ggplot2::geom_vline(xintercept = 20,
                        color = "gray", #"#36C5F0",
                        size = 1,
                        linetype = 3) +
    ggplot2::geom_line(data = x, 
                       ggplot2::aes(x = SEM,
                                    y = q75-10),
                       col = "#E01E5A",
                       size = 3) +
    ggplot2::geom_line(data = y, 
                       ggplot2::aes(x = SEM,
                                    y = y),
                       color = "#2EB67D", #"#36C5F0",
                       size = 3) +
    ggplot2::ylab("Número de Casos") +
    ggplot2::xlab("Semanas Epidemiológicas") +
    ggplot2::annotate("text",
                      label = "Control Proactivo",
                      x = 10, 
                      y = 450,
                      #text = "risk",
                      col = "#2EB67D",
                      size = 6) +
    ggplot2::annotate("text",
                      label = "Escenarios Operativos \nbasados \nen \nTransmisión Persistente",
                      x = 10, 
                      y = 380,
                      #text = "risk",
                      col = "#2EB67D",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control Reactivo",
                      x = 42, 
                      y = 450,
                      #text = "risk",
                      col = "#E01E5A",
                      size = 6) +
    ggplot2::annotate("text",
                      label = "Escenarios Operativos \nbasados \nen \nTransmisión Activa",
                      x = 45, 
                      y = 380,
                      #text = "risk",
                      col = "#E01E5A",
                      size = 4) +
    ggplot2::geom_line(data = prob, 
                       ggplot2::aes(x = SEM,
                                    y = prob),
                       color = "#36C5F0",
                       size = 2)  +
    ggplot2::annotate("text",
                      label = "Acciones Específicas Básicas",
                      x = 10, 
                      y = 280,
                      col = "gray",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control de Probables",
                      x = 10, 
                      y = 250,
                      col = "#36C5F0",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Rociado Residual",
                      x = 10, 
                      y = 220,
                      col = "#ECB22E",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control Larvario",
                      x = 10, 
                      y = 200,
                      col = "#ECB22E",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Acciones Específicas de Soporte",
                      x = 10, 
                      y = 150,
                      col = "gray",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Termonebulización,\n Nebulización, & \nEliminación Masiva de Criaderos",
                      x = 10, 
                      y = 110,
                      col = "gray",
                      size = 3)

```

## [Operacionalización del MIA]{style="color:#003300"}

<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r mia_mexico, echo=FALSE, warning=FALSE, message=FALSE}
# Step 1. load the dataset #####
load("/Users/fdzul/Library/CloudStorage/OneDrive-Personal/automatic_read_sinave/8.RData/epid_channel_data.RData")

# Step 2. extract the dengue cases of veracruz ####
x <- x |>
    dplyr::filter(DES_EDO_RES == "VERACRUZ") 

y <- tibble::tibble(SEM = x$SEM,
                    y = x$q25,
                    arm = "Nuevo Paradigma")
prob <- tibble::tibble(SEM = x$SEM,
                       prob = rep(0, length(x$SEM)))

# plot risk stratificaction  #####
ggplot2::ggplot() +
    ggplot2::geom_rect(ggplot2::aes(xmin = c(-Inf, 25), 
                                    xmax = c(25, Inf), 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = c("#2EB67D", "#E01E5A"),
                       alpha = .2) +
    ggplot2::geom_rect(ggplot2::aes(xmin = 20, 
                                    xmax = 25, 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = "#ECB22E",
                       alpha = 0.8) +
    ggplot2::geom_rect(ggplot2::aes(xmin = 38, 
                                    xmax = 40, 
                                    ymin = -Inf, 
                                    ymax = Inf),
                       fill = "#36C5F0",
                       alpha = 0.8) +
    ggplot2::geom_vline(xintercept = 25,
                        color = "gray", #"#36C5F0",
                        size = 1,
                        linetype = 3) +
    ggplot2::geom_vline(xintercept = 20,
                        color = "gray", #"#36C5F0",
                        size = 1,
                        linetype = 3) +
    ggplot2::geom_line(data = x, 
                       ggplot2::aes(x = SEM,
                                    y = q75-10),
                       col = "#E01E5A",
                       size = 3) +
    ggplot2::geom_line(data = y, 
                       ggplot2::aes(x = SEM,
                                    y = y),
                       color = "#2EB67D", #"#36C5F0",
                       size = 3) +
    ggplot2::ylab("Número de Casos") +
    ggplot2::xlab("Semanas Epidemiológicas") +
    ggplot2::annotate("text",
                      label = "Control Proactivo",
                      x = 10, 
                      y = 450,
                      #text = "risk",
                      col = "#2EB67D",
                      size = 6) +
    ggplot2::annotate("text",
                      label = "Escenarios Operativos \nbasados \nen \nTransmisión Persistente",
                      x = 10, 
                      y = 380,
                      #text = "risk",
                      col = "#2EB67D",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control Reactivo",
                      x = 42, 
                      y = 450,
                      #text = "risk",
                      col = "#E01E5A",
                      size = 6) +
    ggplot2::annotate("text",
                      label = "Escenarios Operativos \nbasados \nen \nTransmisión Activa",
                      x = 45, 
                      y = 380,
                      #text = "risk",
                      col = "#E01E5A",
                      size = 4) +
    ggplot2::geom_line(data = prob, 
                       ggplot2::aes(x = SEM,
                                    y = prob),
                       color = "#36C5F0",
                       size = 2)  +
    ggplot2::annotate("text",
                      label = "Acciones Específicas Básicas",
                      x = 10, 
                      y = 280,
                      col = "gray",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control de Probables",
                      x = 10, 
                      y = 250,
                      col = "#36C5F0",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Rociado Residual",
                      x = 10, 
                      y = 220,
                      col = "#ECB22E",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Control Larvario",
                      x = 10, 
                      y = 200,
                      col = "#ECB22E",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Acciones Específicas de Soporte",
                      x = 10, 
                      y = 150,
                      col = "gray",
                      size = 4) +
    ggplot2::annotate("text",
                      label = "Termonebulización,\n Nebulización, & \nEliminación Masiva de Criaderos",
                      x = 10, 
                      y = 110,
                      col = "gray",
                      size = 3)

```

## [Transmisión Persistente (Hotspots)]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

<html>
<head>
```{=html}
<style>
.grid-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  padding: 5px;
}

.grid-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.8);
  padding: 5px;
  font-size: 30px;
  text-align: center;
}
</style>
```
</head>
<body>
<h1>
</h1>
<p>
</p>

::: grid-container

::: grid-item
Localidad
:::

::: grid-item
Transmisión
:::

::: grid-item
Vector
:::

::: grid-item
Escenarios
:::

::: grid-item
Mérida
:::

::: grid-item
```{r hotspots_cases_merida, out.height="110%", out.width="110%"}
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
library(magrittr)
cases_hotspots_agebs19 |>
    sf::st_make_valid() |>
    dplyr::filter(loc == "Merida") |>
denhotspots::staticmap_intensity(pal = rcartocolor::carto_pal,
                                 pal_name = TRUE,
                                 name = "OrYel",
                                 breaks = 1,
                                 dir_pal = -1,
                                 x_leg = 0.5,
                                 y_leg = 0.1,
                                 ageb = TRUE)
```
:::

::: grid-item
```{r hotspots_vector_merida, out.height="110%", out.width="110%"}
source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/intensity_eggs.R")
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")
betas_31_yucatan |>
    dplyr::filter(year == 2019) |>
    intensity_eggs(locality = "Mérida",
                    cve_ent = "31",
                    palette = rcartocolor::carto_pal,
                    name = "SunsetDark")
```
:::

::: grid-item
```{r risk_merida, out.height="110%", out.width="110%"}
# load the dengue cases hotspots
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
hotspots <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
# load the betas 
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")

###
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_agebs.R")
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_map.R")
risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Mérida",
                   cve_ent = "31",
                   intensity_perc = 25)
risk_map(risk = risk, staticmap = TRUE) 
```
:::

::: grid-item
Valladolid
:::

::: grid-item
```{r hotspots_cases_valladolid, out.height="110%", out.width="100%"}
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
library(magrittr)
cases_hotspots_agebs19 |>
    sf::st_make_valid() |>
    dplyr::filter(loc == "Valladolid") |>
denhotspots::staticmap_intensity(pal = rcartocolor::carto_pal,
                                 pal_name = TRUE,
                                 name = "OrYel",
                                 breaks = 1,
                                 dir_pal = -1,
                                 x_leg = 0.5,
                                 y_leg = 0.1,
                                 ageb = TRUE)
```
:::

::: grid-item
```{r hotspots_vector_valladolid, out.height="110%", out.width="110%"}
source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/intensity_eggs.R")
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")
betas_31_yucatan |>
    dplyr::filter(year == 2019) |>
    intensity_eggs(locality = "Valladolid",
                    cve_ent = "31",
                    palette = rcartocolor::carto_pal,
                    name = "SunsetDark")
```
:::

::: grid-item
```{r risk_valladolid, out.height="110%", out.width="110%"}
# load the dengue cases hotspots
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
hotspots <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
# load the betas 
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")

###
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_agebs.R")
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_map.R")
risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Valladolid",
                   cve_ent = "31",
                   intensity_perc = 25)
risk_map(risk = risk, staticmap = TRUE) 
```
:::

:::

</body>
</html>


## [Escenarios Operativos]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r risk_merida2}
# load the dengue cases hotspots
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
hotspots <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
# load the betas 
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")

###
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_agebs.R")
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_map.R")
merida_risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Mérida",
                   cve_ent = "31",
                   intensity_perc = 25)
valladolid_risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Valladolid",
                   cve_ent = "31",
                   intensity_perc = 25)
a <- risk_map(risk = merida_risk, 
              staticmap = TRUE) +
  ggplot2::ggtitle("Merida")

b <- risk_map(risk = valladolid_risk, 
              staticmap = TRUE) +
  ggplot2::ggtitle("Valladolid")
library(patchwork)
a | b

```



## [Escenarios Operativos]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r risk_ticul}
# load the dengue cases hotspots
load("~/Library/CloudStorage/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
hotspots <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
# load the betas 
load("~/Library/CloudStorage/OneDrive-Personal/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")

###
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_agebs.R")
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/risk_map.R")
merida_risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Ticul",
                   cve_ent = "31",
                   intensity_perc = 25)
valladolid_risk <- risk_agebs(spde_model = betas_31_yucatan,
                   hotspots = cases_hotspots_agebs19,
                   locality = "Tizimín",
                   cve_ent = "31",
                   intensity_perc = 25)
a <- risk_map(risk = merida_risk, 
              staticmap = TRUE) +
  ggplot2::ggtitle("Ticul")

b <- risk_map(risk = valladolid_risk, 
              staticmap = TRUE) +
  ggplot2::ggtitle("Tizimin")
library(patchwork)
a | b

```


## [Transmisión Activa]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

<html>
<head>
```{=html}
<style>
.grid-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  padding: 5px;
}

.grid-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.8);
  padding: 5px;
  font-size: 30px;
  text-align: center;
}
</style>
```
</head>
<body>
<h1>
</h1>
<p>
</p>

::: grid-container

::: grid-item
Localidad
:::

::: grid-item
Transmisión
:::

::: grid-item
Vector
:::

::: grid-item
Escenarios
:::

::: grid-item
Mérida
:::

::: grid-item
```{r cadenas_merida_2023}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

# 2. aplicar la prueba de knox
z <- z |>
    as.data.frame() |>
    sf::st_as_sf(coords = c("long", "lat"),
                 crs = 4326) |>
    dplyr::mutate(onset = lubridate::ymd(FEC_INI_SIGNOS_SINT))

loc <- rgeomex::extract_locality(cve_edo = "31",
                                 locality = "Mérida")
library(magrittr)
denhotspots::knox(x = z[loc,], 
                  crs = "+proj=eqc", 
                  ds = 400, 
                  dt = 20, 
                  sym = 1000, 
                  sp_link = FALSE,
                  planar_coord = FALSE) |>
    denhotspots::space_time_link_map(
        locality = "Merida",
        cve_edo = "31",
        maptype = "staticmap",
        facetmap = FALSE)
```
:::

::: grid-item
```{r hotspots_vector_merida_2023}
load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
deneggs::eggs_hotspots_intensity_map(spde_betas = merida$betas,
                                     years = 2023,
                                     locality = "Merida",
                                     cve_ent = "31",
                                     palette = rcartocolor::carto_pal,
                                     name = "SunsetDark")
```

:::

::: grid-item
```{r risk_escenario_actual_merida}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

risk_transmision_activa(betas = merida$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Merida")
```
:::

::: grid-item
Valladolid
:::

::: grid-item
```{r cadenas_valladolid_2023}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

# 2. aplicar la prueba de knox
z <- z |>
    as.data.frame() |>
    sf::st_as_sf(coords = c("long", "lat"),
                 crs = 4326) |>
    dplyr::mutate(onset = lubridate::ymd(FEC_INI_SIGNOS_SINT))

loc <- rgeomex::extract_locality(cve_edo = "31",
                                 locality = "Valladolid")
library(magrittr)
denhotspots::knox(x = z[loc,], 
                  crs = "+proj=eqc", 
                  ds = 400, 
                  dt = 20, 
                  sym = 1000, 
                  sp_link = FALSE,
                  planar_coord = FALSE) |>
    denhotspots::space_time_link_map(
        locality = "Valladolid",
        cve_edo = "31",
        maptype = "staticmap",
        facetmap = FALSE)
```
:::

::: grid-item
```{r hotspots_vector_valladolid_2023}
load("~/OneDrive/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
deneggs::eggs_hotspots_intensity_map(spde_betas = valladolid$betas,
                                     years = 2023,
                                     locality = "Valladolid",
                                     cve_ent = "31",
                                     palette = rcartocolor::carto_pal,
                                     name = "SunsetDark")
```

:::

::: grid-item
```{r risk_escenario_actual_valladolid}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

risk_transmision_activa(betas = valladolid$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Valladolid")
```
:::

:::

</body>
</html>



## [Transmisión Activa]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

<html>
<head>
```{=html}
<style>
.grid-container {
  display: grid;
  grid-template-columns: auto auto auto auto;
  padding: 5px;
}

.grid-item {
  background-color: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.8);
  padding: 5px;
  font-size: 30px;
  text-align: center;
}
</style>
```
</head>
<body>
<h1>
</h1>
<p>
</p>

::: grid-container

::: grid-item
Localidad
:::

::: grid-item
Transmisión
:::

::: grid-item
Vector
:::

::: grid-item
Escenarios
:::

::: grid-item
Ticul
:::

::: grid-item
```{r cadenas_ticul_2023}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

# 2. aplicar la prueba de knox
z <- z |>
    as.data.frame() |>
    sf::st_as_sf(coords = c("long", "lat"),
                 crs = 4326) |>
    dplyr::mutate(onset = lubridate::ymd(FEC_INI_SIGNOS_SINT))

loc <- rgeomex::extract_locality(cve_edo = "31",
                                 locality = "Ticul")
library(magrittr)
denhotspots::knox(x = z[loc,], 
                  crs = "+proj=eqc", 
                  ds = 400, 
                  dt = 20, 
                  sym = 1000, 
                  sp_link = FALSE,
                  planar_coord = FALSE) |>
    denhotspots::space_time_link_map(
        locality = "Ticul",
        cve_edo = "31",
        maptype = "staticmap",
        facetmap = FALSE)
```
:::

::: grid-item
```{r hotspots_vector_ticul_2023}
load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
deneggs::eggs_hotspots_intensity_map(spde_betas = ticul$betas,
                                     years = 2023,
                                     locality = "Ticul",
                                     cve_ent = "31",
                                     palette = rcartocolor::carto_pal,
                                     name = "SunsetDark")
```

:::

::: grid-item
```{r risk_escenario_actual_ticul}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

risk_transmision_activa(betas = ticul$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Ticul")
```
:::

::: grid-item
Tizimin
:::

::: grid-item
```{r cadenas_tizimin_2023}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

# 2. aplicar la prueba de knox
z <- z |>
    as.data.frame() |>
    sf::st_as_sf(coords = c("long", "lat"),
                 crs = 4326) |>
    dplyr::mutate(onset = lubridate::ymd(FEC_INI_SIGNOS_SINT))

loc <- rgeomex::extract_locality(cve_edo = "31",
                                 locality = "Tizimín")
library(magrittr)
denhotspots::knox(x = z[loc,], 
                  crs = "+proj=eqc", 
                  ds = 400, 
                  dt = 20, 
                  sym = 1000, 
                  sp_link = FALSE,
                  planar_coord = FALSE) |>
    denhotspots::space_time_link_map(
        locality = "Tizimín",
        cve_edo = "31",
        maptype = "staticmap",
        facetmap = FALSE)
```
:::

::: grid-item
```{r hotspots_vector_tizimin_2023}
load("~/OneDrive/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
deneggs::eggs_hotspots_intensity_map(spde_betas = tizimin$betas,
                                     years = 2023,
                                     locality = "Tizimín",
                                     cve_ent = "31",
                                     palette = rcartocolor::carto_pal,
                                     name = "SunsetDark")
```

:::

::: grid-item
```{r risk_escenario_actual_tizimin}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

risk_transmision_activa(betas = tizimin$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Tizimín")
```
:::

:::

</body>
</html>





## [Escenarios de la Transmisión Activa]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r risk_escenario_actual1, out.height="100%", out.width="100%"}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

a <- risk_transmision_activa(betas = merida$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Merida") +
  ggplot2::ggtitle("Merida")
b <- risk_transmision_activa(betas = valladolid$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Valladolid") +
  ggplot2::ggtitle("Valladolid")


library(patchwork)
a | b
```


## [Escenarios de la Transmisión Activa]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r risk_escenario_actual2, out.height="100%", out.width="100%"}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

a <- risk_transmision_activa(betas = ticul$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Ticul") +
  ggplot2::ggtitle("Ticul")
b <- risk_transmision_activa(betas = tizimin$betas,
                        geocoded_data =  z,
                        cve_edo = "31",
                        locality = "Tizimín") +
  ggplot2::ggtitle("Tizimín")


library(patchwork)
a | b
```



## [Datos Básicos]{style="color:#003300"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

```{r}
# step 1. load the data
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/8.RData/eggs_hotspots_2023.RData")
    source("~/Library/CloudStorage/Dropbox/r_developments/r_talks/2023/reunion_interstatal_2023/reunion_quintana_roo/functions/risk_transmission_activa.R")
    source("~/Library/CloudStorage/OneDrive-Personal/proyects/talks/reunion_inter_estatal/3.Functions/active_transmission_dat.R")
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

dplyr::bind_rows(active_transmission_dat(betas = merida$betas,
                                         geocoded_data = z,
                                         cve_edo = "31",
                                         locality = "Merida") |>
                     dplyr::filter(municipio == 50) |>
                     dplyr::mutate(localidad = "Mérida") |>
                     dplyr::select(localidad, municipio, sectores, 
                                   blocks, chains, hotspots),
                 active_transmission_dat(betas = valladolid$betas,
                                         geocoded_data = z,
                                         cve_edo = "31",
                                         locality = "Valladolid") |>
                     dplyr::mutate(localidad = "Valladolid") |>
                     dplyr::select(localidad, municipio, sectores, 
                                   blocks, chains, hotspots),
                 active_transmission_dat(betas = ticul$betas,
                                         geocoded_data = z,
                                         cve_edo = "31",
                                         locality = "Ticul") |>
                     dplyr::mutate(localidad = "Ticul") |>
                     dplyr::select(localidad, municipio, sectores, 
                                   blocks, chains, hotspots),
                 active_transmission_dat(betas = tizimin$betas,
                                         geocoded_data = z,
                                         cve_edo = "31",
                                         locality = "Tizimín") |>
                     dplyr::mutate(localidad = "Tizimín") |>
                     dplyr::select(localidad, municipio, sectores, 
                                   blocks, chains, hotspots)) |>
    reactable::reactable(style = list(fontSize = '16px'),
                         bordered = TRUE, 
                         striped = TRUE, 
                         highlight = TRUE)
```


## [Dios Botic]{style="color:#003300;"}
<hr style="height:2px;border-width:0;color:#330019;background-color:#330019">

-   ***Bio*** : https://fdzul.github.io/web_site_fadm/

-   ***email*** : [felipe.dzul.m@gmail.com]()

-   ***celular*** : [8139945623]()

-   ***slides***: https://lustrous-lollipop-0c305e.netlify.app/reunion_quintana_roo/#/
